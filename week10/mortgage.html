<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Mortgage</title>
   <link rel="stylesheet" type="text/css" href="./stylesheet.css">
</head>

<body>
   <form action="mortgage.php" method="get">
      <fieldset>
         <legend><h2>Mortgage Calculator</h2></legend>
         <label for="apr">Annual Percentage Rate (%)</label>
         <input type="text" id="apr" name="apr" onblur="validateAPR()" required><br><br>
         <label for="term">Loan Term (Years)</label>
         <input type="text" id="term" name="term" onblur="validateLoanTerm()" required><br><br>
         <label for="amount">Loan Amount ($USD)</label>
         <input type="text" id="amount" name="amount" required><br><br>
         <label for="payment">Monthly Payment ($USD)</label>
         <output id="payment"></output><br><br>
         <button type="reset" id="clear" onclick="document.getElementById('apr').focus()">Clear</button>
         <input type="submit">
         <output id="errorMessage"></output>
      </fieldset>
   </form>

   <script>

      function validateAPR() {
         var apr = document.getElementById("apr").value;
         console.log(apr);
         if (apr <= 0 || apr > 25 || apr == "") {
            document.getElementById("errorMessage").value = "Annual Percentage Rate not within range";
            document.getElementById("apr").focus();
            return false;
         }
         else
            document.getElementById("errorMessage").value = "";
         return true;
      }
      function validateLoanTerm() {
         var term = document.getElementById("term").value;
         console.log(term);
         if (term <= 0 || term > 40 || term == "") {
            document.getElementById("errorMessage").value = "Loan Term not within range"
            document.getElementById("term").focus();
            return false;
         }
         else
            document.getElementById("errorMessage").value = "";
         return true;

      }
      function validateAll() {
         if (validateAPR() && validateLoanTerm()) {
            outputMonthlyPayment();
         }
      }
      function outputMonthlyPayment() {
         var loanAmount = document.getElementById("amount").value;
         var apr = (document.getElementById("apr").value / 12) / 100;
         var term = document.getElementById("term").value * 12;
         console.log(loanAmount);
         console.log(apr);
         console.log(term);
         var monthlyPayment = loanAmount * ((apr * ((1 + apr) ** term)) / (((1 + apr) ** term) - 1));
         monthlyPayment = monthlyPayment.toFixed(2);
         document.getElementById("payment").value = monthlyPayment;
      }
   </script>
</body>

</html>